--- FRESH CARPOOL DB CREATION ---
./create_fresh_carpool_db.sh <DB name>


--- CLEAN UP ---
psql -d <DB name> <  clean_up.sql


--- SCHEMA NAME ---
carpoolvote


--- DATABASE ROLES -----
carpool_admins    : all privileges 
                    contains individual personal users whose role is to maintain the schema
capool_role       : privileges to run the matching engine
                    contains carpool_match_engine database user which should be used to execute the matching engine.
carpool_web_role  : privileges to perform action supported by front end
                    contains the carpool_web database user which should be used by the front end to connect to the database

					
--- TABLES, VIEWS, SEQUENCES, INDEXES ----
echo "\d+ carpoolvote.*" | psql -d <DB name>



-- return codes (out_error_code) : 
-- -1  : ERROR - Generic Error
--  0  : SUCCESS
--  1  : ERROR - Input is disabled
--  2  : ERROR - Input validation


--- USER INPUT : drivers, riders, helpers ---
echo "\df carpoolvote.submit_new*" | psql -d <DB name>

submit_new_driver(...,  OUT out_uuid character varying, OUT out_error_code integer, OUT out_error_text text)
submit_new_rider (...,  OUT out_uuid character varying, OUT out_error_code integer, OUT out_error_text text)
submit_new_helper(...,  OUT out_uuid character varying, OUT out_error_code integer, OUT out_error_text text)

-- actions by rider  ----
rider_cancel_ride_request(UUID, phone number or lastname ?, OUT out_error_code INTEGER, OUT out_error_text TEXT)
rider_cancel_confirmed_match(UUID_driver, UUID_rider, score, rider’s phone number or rider’s lastname ?, OUT out_error_code INTEGER, OUT out_error_text TEXT)

-- actions by driver -----
driver_cancel_drive_offer(UUID, phone number or lastname ?, OUT out_error_code INTEGER, OUT out_error_text TEXT)
driver_cancel_confirmed_match(UUID_driver, UUID_rider, score, driverr’s phone number or driver’s lastname ?, OUT out_error_code INTEGER, OUT out_error_text TEXT)
driver_confirm_match(UUID_driver, UUID_rider, score, driver’s phone number or driver’s lastname ?, OUT out_error_code INTEGER, OUT out_error_text TEXT)
driver_pause_match(UUID, phone number or lastname ?, OUT out_error_code INTEGER, OUT out_error_text TEXT)


-- State transitions ---

[0]    -----> submit_new_driver [1] driver : Pending [OK]
[0]    -----> submit_new_rider  [2] rider : Pending [OK]
[0]    -----> submit_new_helper [3] 

[1][2] -----> match             [4] match : MatchProposed, driver : MatchProposed, rider : MatchProposed [OK]

[1]    -----> driver_cancel_drive_offer  [5]  driver : Canceled [OK]
[2]    -----> rider_cancel_ride_request  [6]  rider : Canceled  [OK]

[4]    -----> driver_cancel_drive_offer  [7]  match : Canceled, driver : Canceled, rider : Pending/MatchProposed
[4]    -----> rider_cancel_ride_request  [8]  match : Canceled, driver : Pending/MatchProposed, rider : Canceled

[5]    -----> driver_cancel_drive_offer  [5]  driver : Canceled [OK]
[6]    -----> rider_cancel_ride_request  [6]  rider : Canceled  [OK]

[4]    -----> driver_confirm_match       [9]  match : MatchConfirmed, driver : MatchConfirmed, rider : MatchConfirmed [OK]

[9]    -----> driver_cancel_confirmed_match [10]  match : Canceled, driver : MatchProposed/Pending, rider : MatchProposed/Pending
[9]    -----> rider_cancel_confirmed_match  [11]  match : Canceled, driver : MatchProposed/Pending, rider : MatchProposed/Pending
[10]   -----> driver_cancel_drive_offer  [5]
[11]   -----> rider_cancel_ride_request  [6]

[9]    -----> driver_cancel_drive_offer  [5]
[9]    -----> rider_cancel_ride_request  [6]